<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <!-- 8-bit style font -->
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: black;
    }

    canvas {
      border: 1px solid black;
      background-color: #1f1f1f;
    }

    #best {
      font-family: 'Press Start 2P', cursive;
      font-size: 24px;
      color: white;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <canvas id="gameCanvas" width="800" height="800"></canvas>
  <p id="best">Best: 0</p>
  <audio id="biteSound" src="./zap.mp3"></audio>
  <audio id="gameOverSound" src="./boom.mp3"></audio>
  <audio id="celebrationSound" src="./celebration.mp3"></audio>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const context = canvas.getContext('2d');
    const biteSound = document.getElementById('biteSound');
    const gameOverSound = document.getElementById('gameOverSound');
    const celebrationSound = document.getElementById('celebrationSound');
    const boxSize = 40;
    let snake = [{ x: 5, y: 5 }];
    let food = { x: Math.floor(Math.random() * 20), y: Math.floor(Math.random() * 20) };
    let dx = 1, dy = 0;
    let gameOver = false;
    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;
    document.getElementById('best').innerText = `Best: ${highScore}`;

    document.addEventListener('keydown', function (event) {
      if (gameOver) {
        snake = [{ x: 5, y: 5 }];
        dx = 1; dy = 0;
        score = 0;
        gameOver = false;
        draw();
        return;
      }
      switch (event.keyCode) {
        case 37: if (dx === 0 && dy !== 0) { dx = -1; dy = 0; } break; // Left
        case 38: if (dy === 0 && dx !== 0) { dx = 0; dy = -1; } break; // Up
        case 39: if (dx === 0 && dy !== 0) { dx = 1; dy = 0; } break; // Right
        case 40: if (dy === 0 && dx !== 0) { dx = 0; dy = 1; } break; // Down
      }
    });

    function draw() {
      context.clearRect(0, 0, canvas.width, canvas.height);

      // Draw snake
      for (let cell of snake) {
        context.fillStyle = 'yellow';
        context.fillRect(cell.x * boxSize, cell.y * boxSize, boxSize, boxSize);
      }

      // Draw food
      context.fillStyle = 'white';
      context.fillRect(food.x * boxSize, food.y * boxSize, boxSize, boxSize);

      // Draw score
      context.fillStyle = 'white';
      context.font = '40px "Press Start 2P"';
      context.textAlign = 'start';  // Default value
      context.textBaseline = 'alphabetic';  // Default value
      context.fillText(score, 20, 50);

      // Move snake
      let head = { x: snake[0].x + dx, y: snake[0].y + dy };

      // Check for food collision
      if (head.x === food.x && head.y === food.y) {
        food = { x: Math.floor(Math.random() * 20), y: Math.floor(Math.random() * 20) };
        score++;
        biteSound.play();
      } else {
        snake.pop();
      }

      // Check for wall or self collision
      if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(cell => cell.x === head.x && cell.y === head.y)) {
        gameOver = true;
        gameOverSound.play();
        context.fillStyle = 'white';
        context.font = '70px "Press Start 2P"';
        context.strokeStyle = 'yellow';
        context.lineWidth = 5;
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText('GAME OVER', canvas.width / 2, canvas.height / 2);
        context.strokeText('GAME OVER', canvas.width / 2, canvas.height / 2);
        if (score > highScore) {
          localStorage.setItem('highScore', score);
          document.getElementById('best').innerText = `Best: ${score}`;
          celebrationSound.play();
          context.font = '40px "Press Start 2P"';
          context.fillText('New High Score!', canvas.width / 2, canvas.height / 2 + 50);
        }
        return;
      } else {
        snake.unshift(head);
      }

      setTimeout(draw, 100);
    }

    draw();
  </script>
</body>

</html>